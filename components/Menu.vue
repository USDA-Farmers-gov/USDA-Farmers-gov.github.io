<template>
  <div>
    <img class="logo" alt="Farmers.gov" src="/images/farmers-logo.svg"/>
    <ul class="menu-container">
      <li v-for="item in menu">
        <div :class="setClassesByCategory(item.category)" 
              @click="setActiveCategoryOnEvent($event, item)"
              @keypress="setActiveCategoryOnEvent($event, item)"
              tabindex="0">
                {{ item.category }}
                <i v-if="activeCategory === item.category && !item.path" class="arrow arrow-up"></i>
                <i v-if="activeCategory !== item.category && !item.path" class="arrow arrow-down"></i>
        </div>

        <ul v-if="activeCategory === item.category" class="menu-links">
          <li :class="currentPath === link.path ? 'active soft-green' : ''" v-for="link in item.links">
            <a :href="link.path">{{ link.name }}</a>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</template>

<script>
  export default {
    data() {
      return {
        currentPath: this.$route.path !== '/' ? this.$route.path.replace(/\/$/, "") : this.$route.path, // .replace() removes trailing slashes
        activeCategory: '',
        categoryClasses: 'category',
        menu: [
          {
            category: 'Overview',
            path: '/'
          },
          {
            category: 'Primary Elements',
            links:  [
                      { name: 'Colors', path: '/elements/Colors'},
                      { name: 'Grid', path: '/elements/Grid'},
                      { name: 'Typography', path: '/elements/Typography'},
                    ]
          },
          {
            category: 'UI Components',
            links:  [
                      { name: 'Accordions', path: '/ui/Accordions'},
                      { name: 'Buttons', path: '/ui/Buttons'},
                      { name: 'Checkboxes', path: '/ui/Checkboxes'},
                      { name: 'Dividers', path: '/ui/Dividers'},
                      // { name: 'Dropdowns', path: '/ui/Dropdowns'},
                      { name: 'Radio Buttons', path: '/ui/RadioButtons'},
                    ]
          },
          // {
          //   category: 'Navigation',
          //   links:  [
          //             { name: 'Breadcrumbs', path: '/navigation/Breadcrumbs'},
          //           ]
          // }
        ]
      }
    },
    mounted() {
      this.setActiveCategoryOnLoad()
    },
    methods: {
      setClassesByPath(path) {
        return (path === this.currentPath) ? this.categoryClasses + ' active' : this.categoryClasses
      },
      setClassesByCategory(category) {
        return (this.activeCategory === category) ? this.categoryClasses + ' active' : this.categoryClasses
      },
      setActiveCategoryOnLoad() {
        let data = this.menu.map(row => (row.links) ? row.links.filter(link => link.path === this.currentPath).length : 0)
        let index = data.findIndex(row => row)
        this.activeCategory = (index !== -1) ? this.menu[index].category : ''
      },
      setActiveCategoryOnEvent(e, item) {
        if(e.type === 'keypress') {
          (e.code === 'Enter' && item.path) ? this.$router.push({ path: item.path }) : this.activeCategory = item.category
        } else {
          item.path ? this.$router.push({ path: item.path }) : this.activeCategory = item.category
        }
      }
    }
  }
</script>
